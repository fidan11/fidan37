<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>

    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
            crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/index.css">
    <script src="/js/index.js"></script>

    <script>
        function addStudent() {
            //get all inputs and generate student json
            //send post request
            //close modal
            //showAllStudents

        }

        function showAllStudents() {
            var xmlHttp = new XMLHttpRequest();
            var url = "http://localhost:8080/rest/students?";
            url += "&name=" + document.getElementById("name").value;
            url += "&surname=" + document.getElementById("surname").value;
            url += "&age=" + document.getElementById("age").value;
            url += "&scholarship=" + document.getElementById("scholarship").value;
            xmlHttp.open("GET", url, false);
            xmlHttp.send(null);
            var list = JSON.parse(xmlHttp.responseText);<!--Stringi JSON.parse deyerek obyekte cevirir-->
            var studentsPanelRest = document.getElementById("tablerows");
            var trstr = "<tr>\n" +
                "            <td>:id</td>\n" +
                "            <td>:name</td>\n" +
                "            <td>:surname</td>\n" +
                "            <td>:age</td>\n" +
                "            <td>:scholarship</td>\n" +
                "            <td>:schoolname</td>\n" +
                "            <td>:teachername</td>\n" +
                "            <td>\n" +
                "                <form method=\"POST\" action=\"/students/delete\">\n" +
                "                    <input type=\"hidden\" name=\"id\" value=\":id\"/>\n" +
                "                    <button type=\"button\"\n" +
                "                            class=\"btn btn-danger\"\n" +
                "                            data-bs-toggle=\"modal\"\n" +
                "                            data-bs-target=\"#panelDelete\"\n" +
                "                            onclick=\"fillSelectedItemForDelete(:id)\"\n" +
                "                    >Delete\n" +
                "                    </button>\n" +
                "\n" +
                "                    <button type=\"button\"\n" +
                "                            class=\"btn btn-secondary\"\n" +
                "                            data-bs-toggle=\"modal\" data-bs-target=\"#panelUpdate\"\n" +
                "                            onclick=\"fillSelectedItemForUpdate(\n" +
                "                            :id,\n" +
                "                            ':name',\n" +
                "                            ':surname',\n" +
                "                            :age,\n" +
                "                            :scholarship\n" +
                "                             )\">\n" +
                "                        \n" +
                "                        Update</button>\n" +
                "                </form>\n" +
                "            </td>\n" +
                "        </tr>";
            studentsPanelRest.innerHTML = ""
            for (var i = 0; i < list.length; i++) {
                var teachers = "";
                for (var j = 0; j < list[i].teacherList.length; j++) {
                    teachers += list[i].teacherList[j].name + ";";
                }
                studentsPanelRest.innerHTML = studentsPanelRest.innerHTML +
                    trstr.replaceAll(":id", list[i].id)
                        .replaceAll(":name", list[i].name)
                        .replaceAll(":surname", list[i].surname)
                        .replaceAll(":age", list[i].age)
                        .replaceAll(":scholarship", list[i].scholarship)
                        .replaceAll(":teachername", teachers)
                        .replaceAll(":schoolname", list[i].school.name);
            }
        }
    </script>
</head>
<body>
<button onclick="showAllStudents()">show all students</button>
<div id="studentsPanelRest">

</div>
<div id="main-panel">
    <form method="GET" action="/students" class="row g-3 needs-validation">
        <div class="col-md-3">
            <label>name:</label>
            <input type="text" name="name" class="form-control" id="name"/>
        </div>

        <div class="col-md-3">
            <label>surname:</label>
            <input type="text" name="surname" class="form-control" id="surname"/>
        </div>

        <div class="col-md-3">
            <label>age:</label>
            <input type="age" name="age" class="form-control" id="age"/>
        </div>

        <div class="col-md-3">
            <label>scholarship:</label>
            <input type="text" name="scholarship" class="form-control" id="scholarship"/>
        </div>

        <div class="col-12">
            <button type="button" class="btn btn-primary" onclick="showAllStudents()">Search</button>
            <button type="button" class="btn btn-primary" name="action" value="add" data-bs-toggle="modal"
                    data-bs-target="#panelAdd">Add
            </button>
        </div>
    </form>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>id</th>
            <th>name</th>
            <th>surname</th>
            <th>age</th>
            <th>scholarship</th>
            <th>school</th>
            <th>teachers</th>
            <th>controls</th>
        </tr>
        </thead>
        <tbody id="tablerows">

        </tbody>
    </table>
</div>


<form method="POST" action="/students/add" >
    <div class="modal" tabindex="-1" id="panelAdd">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modal title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div>
                        <label>name:</label>
                        <input type="text" name="name" class="form-control"/>
                    </div>

                    <div>
                        <label>surname:</label>
                        <input type="text" name="surname" class="form-control"/>
                    </div>

                    <div>
                        <label>age:</label>
                        <input type="age" name="age" class="form-control"/>
                    </div>

                    <div>
                        <label>scholarship:</label>
                        <input type="text" name="scholarship" class="form-control"/>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn">Add</button>
                    <button type="button" class="btn" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</form>

<form method="POST" action="/students/update">
    <div class="modal" tabindex="-1" id="panelUpdate">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modal title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" id="idUpdate"/>
                    <div>
                        <label>name:</label>
                        <input type="text" name="name" id="nameUpdate" class="form-control"/>
                    </div>

                    <div>
                        <label>surname:</label>
                        <input type="text" name="surname" id="surnameUpdate" class="form-control"/>
                    </div>

                    <div>
                        <label>age:</label>
                        <input type="age" name="age" id="ageUpdate" class="form-control"/>
                    </div>

                    <div>
                        <label>scholarship:</label>
                        <input type="text" name="scholarship" id="scholarshipUpdate" class="form-control"/>
                    </div>
                </div>
                <div class="modal-footer">

                    <button class="btn">Update</button>
                    <button type="button" class="btn" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


</form>
<form method="POST" action="/students/delete">
    <div class="modal" tabindex="-1" id="panelDelete">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure to delete?
                    <input type="hidden" name="id" id="idDelete"/>
                </div>
                <div class="modal-footer">
                    <button class="btn">Delete</button>
                    <button type="button" class="btn" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</form>
</body>
<script>
    showAllStudents();
</script>
</html>

